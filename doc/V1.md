# V1 Site Audit

## 1. Site overview

- Pages/routes present: `/portfolio/index.html` (root redirect), `/portfolio/<lang>/index.html`, `/portfolio/<lang>/projects.html`, `/portfolio/<lang>/projects/<id>.html`, `/portfolio/<lang>/history.html`, `/portfolio/<lang>/passions.html`, `/portfolio/<lang>/passions/<id>.html`, `/portfolio/<lang>/perspectives.html`, `/portfolio/<lang>/perspectives/<id>.html`, `/portfolio/<lang>/but-informatique.html`, `/portfolio/<lang>/definitions-test.html`.
- General purpose inferred from structure: personal portfolio site with projects, history/timeline, passions, perspectives/essays, a program overview (BUT Computer Science), contact info, and a resume preview.
- Static vs dynamic behavior: HTML is statically generated by PHP; client-side JS provides theme switching, definition tooltips, timeline animation, and project filtering/sorting; data for JS is fetched from `/portfolio/data/*.json`.

## 2. Global layout

- Overall page width constraints: `body` is full-width; horizontal margin tokens are `min(2.5%, 2.5lh)`; text strips often constrain to `60ch` max line length; timeline container has fixed widths (1160px/960px/750px) with responsive fallbacks.
- Grid/column systems: body uses a 3-row CSS grid (header/main/footer); cards and detail headers use CSS grid; general layouts use flex; `#presentation` uses CSS columns with `column-width: 60ch`.
- Header structure: `<header class="lvl">` with a nav (home link + page list), language flags list, and theme switch controls; header uses a bordered strip spanning the full width.
- Footer structure: `<footer class="lvl">` with a centered copyright `<small>` and a GitHub icon link; also uses a bordered strip spanning the full width.
- Responsive behavior: breakpoints at 570px (footer text centering), 700px/701px (detail header logo placement), and timeline breakpoints at 979px, 767px, 639px, 768-979px, 980-1161px; motion scaling is disabled for `prefers-reduced-motion`.

## 3. Typography

- Fonts used: `Ubuntu, system-ui` on `:root`.
- Base size: `:root { font-size: 1.1em; }`.
- Heading hierarchy (font-weight 500 across headings):

| Element | Font size | Line height |
| --- | --- | --- |
| h1 | 2em | `calc(1ex / 0.4)` |
| h2 | 1.75em | `calc(1ex / 0.42)` |
| h3 | 1.5em | `calc(1ex / 0.38)` |
| h4 | 1.25em | `calc(1ex / 0.37)` |
| h5 | 1.125em | `calc(1ex / 0.4)` |
| h6 | 1.0625em | `calc(1ex / 0.5)` |

- Paragraph spacing: paragraphs have no default margin; spacing appears where `.text` or `#story` applies `margin-gap` using `calc(1ex / 0.32)`; line height for `p` and `figcaption` is `calc(1ex / 0.32)`.
- Typographic scale pattern: line-length constrained to 60ch for paragraphs; `small` uses `font-size: 1em` with reduced opacity text color.

## 4. Color system

- Theme model: `data-theme` on `:root` drives dark/light/system; `accent-color` is set to the accent color; `color-scheme` is set to `dark` or `light`.
- Accent color: `--color-accent` = `#a66144`; `--color-accent-fg` = `#ffffff`.
- Foreground/background:

| Variable | Light theme | Dark theme |
| --- | --- | --- |
| --color-fg | `#111` | `#d3d3d3` |
| --color-lvl | `#fafafa` | `#111` |
| --color-lvl-next | `color.scale(--color-lvl, lightness: -8%)` | `color.scale(--color-lvl, lightness: +8%)` |

- Nested `.lvl` elements progressively shift `--color-lvl`/`--color-lvl-next` by additional 8% steps.
- Link colors (only `.link` class): normal `#a66144`, visited `#91553b`, hover/focus `#be7c60` with underline; other anchors inherit text color.
- Code block colors: `pre` and inline `code/samp/kbd` use `background-color: var(--color-lvl-next)`; text inherits foreground color.
- CSS variables defined or used: `--color-accent`, `--color-accent-rgb`, `--color-accent-fg`, `--color-accent-fg-rgb`, `--color-fg`, `--color-fg-rgb`, `--color-lvl`, `--color-lvl-rgb`, `--color-lvl-next`, `--color-lvl-next-rgb`, `--bg-img` (defined via `@property`), `--bg-img-card` (set inline for cards, used in background image mixins).

## 5. Components

| Component | Purpose | HTML structure | CSS classes/selectors | Dimensions/padding | Interaction states |
| --- | --- | --- | --- | --- | --- |
| Header/nav | Global navigation and controls | `<header><nav><a>...</a><ul><li><a>...</a></li></ul></nav>...</header>` | `header.lvl`, `nav`, `nav > ul`, `nav a` | Full-width strip with padding `1em` and horizontal margin token | Underline on hover/focus; no active state class |
| Language flags | Language switcher | `<ul class="list-flags"><li><a class="fi ..."></a></li></ul>` | `.list-flags`, `.fi`, `.gray-when-not-hover` | Inline flex list with `.5em` gaps | Non-current flags grayscale unless hovered |
| Theme switches | Theme selection | `<div class="theme-switches"><label>...<input type="radio"></label>...</div>` | `.theme-switches`, `.theme-switches label:has(input:checked)` | 2em-wide labels, border-radius `.25em` | Checked/hovered label gets accent background; JS updates `data-theme` |
| Button link | CTA-style link | `<a class="lvl button-link">...</a>` | `.button-link` | Padding via `horizontal-box(2)` and border | Hover scales up and applies accent background |
| Iconed text | Inline icon + text | `<a class="link iconed-text">...</a>` | `.iconed-text` | Icon sized to text (`1em`) | Hover inherits link style |
| Rect tag list | Tag or filter chips | `<ul class="list-rect"><li><a>...</a></li></ul>` | `.list-rect` | Small horizontal pill padding via `horizontal-box-padding(.7)` | On project cards, hover scales; in filters, checked/hovered label uses accent |
| Link list (icons) | External links in cards | `<ul class="list-link"><li><a><img/svg></a></li></ul>` | `.list-link` + `util.link-list-card` | Row-reverse, small gaps; icon size `1.5em` | Hover scales icon |
| Link list (buttons) | Links section in detail pages | `<ul class="lvl list-link"><li><a>icon + text</a></li></ul>` | `#links .list-link` | Button-like padding (`horizontal-box(1.5)`) | Hover uses accent background |
| Piano tiles | Home hero grid | `<ul class="lvl list-piano-tiles"><li><figure><img><figcaption>...</figcaption></figure></li></ul>` | `.list-piano-tiles` | Flex wrap; min tile width `180px`; figcaption overlay | Hover or `.hover` class reveals caption and scales tile |
| Project card | Project summary card | `<li>tags + logo + h3 + context + status + abstract + links</li>` | `.list-project > li` | Grid layout; padding `.75em`; flex-basis `20em` | Hover shifts background to accent and adapts text color |
| Detail split card | Passion/perspective cards | `<ul class="list-detail-split-card"><li><logo><div>title + abstract + links</div></li></ul>` | `.list-detail-split-card` | 2-column grid; width 50% centered; logo column min `7.5em` | Hover changes background and foreground to accent |
| Definition card | Definition display | `<article class="definition">h4 + logo + type + synopsis</article>` | `.definition`, `.list-definition` | Grid layout; padding `.75em`; font-size `.8em` | Hover changes background image tint in list |
| Definition tooltip | Inline tooltip for terms | `<template id="template-definition-tooltip">...</template>` | `.definition-tooltip`, `.definition-tooltip-trigger` | Absolutely positioned | JS toggles `.show`/`.hide` with delays (500ms show, 250ms hide) |
| Content block | Sectioned content with background | `<article class="lvl content-block">...</article>` | `.content-block` | Padding `1.5em`, border-radius `1.5em` | None beyond inherited hover on child links |
| Gallery | Detail media gallery | `<ul class="lvl gallery"><li><figure class="figure">...</figure></li></ul>` | `.gallery`, `.figure` | Flex wrap; figure max width `min(26em, 100%)` | None beyond link/icon hover |
| Timeline | History page timeline | `<div class="ag-timeline">...<div class="ag-timeline_item">...</div>` | `.ag-*`, `.js-*` | Centered line at 50%; card width `45%` | JS toggles `.js-ag-active` to slide/opacity in |
| Search bar | Project filter UI | `<section id="search-bar">...</section>` | `#search-bar`, `#search-input`, `#list-tag`, `#list-sorting` | Max width `min(50em, 95%)`, rounded right corners | JS filters list; checked/hovered labels get accent |

## 6. Content patterns

- Projects: stored in `data/<lang>/projects.json`; fields include `title`, `abstract`, `story`, `tags`, `context`, `start-date`, optional `end-date`, `links`, `team`, `technologies`, `references`, `gallery`, optional `logo`, optional `background`; list cards show tags, logo, title, context, status (date range or “ongoing”), abstract, and icon links; detail pages add team/technologies definition lists and gallery.
- Passions and perspectives: stored in `data/<lang>/passions.json` and `data/<lang>/perspectives.json`; fields include `title`, `abstract`, `story`, `links`, `references`, `gallery`, optional `logo`, optional `background`; list pages use split cards; detail pages show header, links, story, references, gallery.
- History/timeline: entries in `data/<lang>/lang.json` under `history[]` with `meta`, `title`, and `body` (HTML or included fragment); images and years are hardcoded in `page_history` and not in JSON.
- Media embedding: gallery items use `url` (image), `iframe-src` (iframe), or `content` (HTML string); `get_iframe()` outputs fixed `300x300` iframe; images and figures are `loading="lazy"` with captions in `<figcaption>`.
- Captions/alt/metadata: `get_img_element()` sets `alt` and `title` when provided; gallery captions are HTML; logo graphics use `get_graphic_element()` which inlines themed SVG or uses `<img>`.
- Definitions: glossary terms come from `data/<lang>/definitions.json` with `name` (full/abbr/short), `type`, `synopsis`, `wiki`, optional `logo` and `background`; definitions appear as cards in project detail pages and as tooltips in story content.

## 7. Navigation

- Menu structure: header nav contains home link “Raphaël Bardini” plus links to Projects, History, Passions, Perspectives, and BUT Computer Science.
- Active state behavior: no explicit active class; hover/focus underlines links; `a[href="#"]` is styled as underlined but templates do not set it.
- Internal linking patterns: page links use `/portfolio/<lang>/<page>.html`; detail links use `projects/<id>.html`, `passions/<id>.html`, `perspectives/<id>.html`; tag links use `projects.html?tag=<id>`; language switches point to the same page name under each language.

## 8. Styling conventions

- Class naming: semantic component classes like `content-block`, `definition`, `theme-switches`, `list-*`; JS hooks use `js-*` (timeline); timeline uses `ag-*`; `.lvl` marks color-level scopes; `.foil` creates full-card clickable overlay.
- Utility vs semantic classes: utilities are mostly SCSS mixins; in markup, utility-like classes are `lvl`, `text`, `margined`, `button-link`, `iconed-text`.
- Inline styles: used for CSS variables `--bg-img` on detail pages and `--bg-img-card` on cards; BUT skills list uses `style="--bg-img: url(...)"` per skill.
- Repeated spacing patterns: `full-width-horizontal-margin` = `min(2.5%, 2.5lh)`, `full-width-vertical-margin` = `2.5lh`, `max-line-length` = `60ch`, heading margins at `1lh`, paragraph spacing via `calc(1ex / 0.32)` when `.text` is applied.

## 9. Generation logic (high-level)

- Data source: JSON under `data/<lang>/*.json` plus language-agnostic JSON under `data/*.json` (anchors, langs, tags, types).
- `$include` mechanism: JSON nodes with `{ "$include": "path.phtml" }` are expanded by `LinkedData` by executing fragments in `fragments/<lang>/...`; output becomes HTML strings in the generated JSON.
- Template composition: `put_regular_page()` builds `<!doctype html>`, head, header, main, footer; page-specific content is rendered by functions in `scripts/include/pages/*.php`.
- Page generation: `scripts/generate.php` builds root index, language pages, and detail pages for each project/passion/perspective; outputs HTML to `/portfolio/<lang>/...`.
- Stylesheet selection: `put_head()` loads `/portfolio/css/<page>.css` if it exists, otherwise falls back to `base.css`.
- Script selection: `base.js` always; page-specific `/portfolio/js/<page>.js` is included if present.
- Asset handling: `get_graphic_element()` inlines themed SVGs or uses `<img>`; `get_img_element()` derives intrinsic sizes and uses `loading="lazy"`.
- Special generation step: `page_index()` uses Ghostscript (`gs`) to generate a CV preview JPEG from a PDF during generation.
- Root redirect: `/portfolio/index.html` uses JS to load `/portfolio/data/langs.json`, match browser language, and redirect to `/portfolio/<lang>`.

## 10. Known quirks and special cases

- History page overrides `box-sizing` to `content-box` for all `main *` and sets `:root { overflow-x: hidden; }`.
- History images and year values are hardcoded in `page_history` rather than driven by JSON entries.
- Definitions tooltip uses show/hide delays and absolute positioning; stacked tooltips use incrementing `z-index`.
- Detail pages hide `h2` inside `#links` and `#story` sections via CSS.
- Projects list page is empty without JS; list and datalist are filled client-side from JSON.
- Index page piano tiles force a staged hover animation via JS by adding/removing a `.hover` class.
- Highlight.js assets are included in the head, but no explicit initialization is present in the JS; usage is unclear from code.
