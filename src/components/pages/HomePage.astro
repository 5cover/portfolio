---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Graphic from '../Graphic';
import ProjectCardList from '../ProjectCardList';
import { type Entry } from '../../lib/content';
import { pageHref } from '../../lib/links';
import { normalizeLocale } from '../../i18n/site';

import '../../styles/index.scss';
import { getRelativeLocaleUrl } from 'astro:i18n';
import type { LocalizedItem } from '../../content/config';

interface Copy {
    indexMe: string;
    indexMyPhoto: string;
    indexOngoingProjects: string;
    indexAllMyProjects: string;
    indexContact: string;
    indexMyResumePreview: string;
    indexMyResume: string;
    indexVideoCv: string;
    ongoing: string;
    fmtTitle: string;
}

interface Props {
    pianoTiles: Entry<LocalizedItem<'piano-tiles'>>[];
    projects: Entry<LocalizedItem<'projects'>>[];
    contacts: Entry<LocalizedItem<'contacts'>>[];
    copy: Copy;
}

const props: Props = Astro.props;
const { pianoTiles, projects, contacts, copy } = props;

const locale = normalizeLocale(Astro.currentLocale);
---

<BaseLayout pageName='index'>
    <main>
        <ul class='lvl list-piano-tiles'>
            {
                pianoTiles.map(([, tile]) => (
                    <li>
                        <figure>
                            <img
                                src={tile.backgroundImage}
                                alt={tile.title}
                                width='240'
                                height='480'
                                loading='lazy'
                                title={tile.summary}
                            />
                            <figcaption>
                                <div>
                                    <h2>
                                        <a class='foil' href={tile.href}>
                                            {tile.title}
                                        </a>
                                    </h2>
                                    <p set:html={tile.summary} />
                                </div>
                            </figcaption>
                        </figure>
                    </li>
                ))
            }
        </ul>
        <article id='me' class='lvl content-block'>
            <div>
                <h2>{copy.indexMe}</h2>
                <slot name='about-content' />
            </div>
            <img
                src='/portfolio/img/me.jpg'
                alt={copy.indexMyPhoto}
                width='1600'
                height='1600'
                loading='lazy'
                title={copy.indexMyPhoto}
            />
        </article>
        <section id='ongoing-projects' class='lvl'>
            <h2>{copy.indexOngoingProjects}</h2>
            <ProjectCardList
                langLabels={{ ongoing: copy.ongoing, fmtTitle: copy.fmtTitle }}
                entry={projects.filter(([, project]) => !project.endDate)}
                locale={locale}
            />
            <a href={pageHref(locale, 'projects')} class='lvl button-link'>
                {copy.indexAllMyProjects}
            </a>
        </section>
        <article id='contact' class='lvl content-block'>
            <div>
                <h2>{copy.indexContact}</h2>
                <address>
                    <ul>
                        {
                            contacts.map(([, contact]) => (
                                <li title={contact.platform}>
                                    <a
                                        class='link iconed-text'
                                        target='_blank'
                                        rel='noopener noreferrer'
                                        href={contact.src}>
                                        <Graphic of={contact.icon} alt={contact.platform} />
                                        <span>{contact.name}</span>
                                    </a>
                                </li>
                            ))
                        }
                    </ul>
                </address>
            </div>
            <a
                href={getRelativeLocaleUrl(normalizeLocale(Astro.currentLocale), 'cv-bardini-raphael.pdf')}
                target='_blank'
                rel='noopener noreferrer'>
                <img
                    src={getRelativeLocaleUrl(normalizeLocale(Astro.currentLocale), 'cv-bardini-raphael-preview.jpg')}
                    alt={copy.indexMyResumePreview}
                    width='212'
                    height='300'
                    loading='lazy'
                />
                <span>{copy.indexMyResume}</span>
            </a>
        </article>
        <article class='lvl content-block'>
            <h2>{copy.indexVideoCv}</h2>
            <iframe
                src='https://www.youtube-nocookie.com/embed/6VqtL5oogwk?modestbranding=1&rel=0'
                width='640'
                height='360'
                title='Video CV - RaphaÃ«l Bardini'
                frameborder='0'
                allowfullscreen></iframe>
        </article>
    </main>
    <script src='../../scripts/index.ts'></script>
</BaseLayout>
