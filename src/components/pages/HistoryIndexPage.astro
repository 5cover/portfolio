---
import BaseLayout from '../../layouts/BaseLayout.astro';
import TextualContent from '../TextualContent.astro';

import type { AstroComponentFactory } from 'astro';
import type { LangEntry, LocalizedHistoryEntry } from '../../lib/content';
import { detailHref } from '../../lib/routes';

import '../../styles/history.scss';

type Props = {
    lang: string;
    langData: LangEntry['data'];
    orderedHistory: LocalizedHistoryEntry[];
    historyBodies: AstroComponentFactory[];
};

const props: Props = Astro.props;
const {
    lang,
    langData,
    orderedHistory,
    historyBodies,
} = props;

 
---

<BaseLayout
    lang={lang}
    pageName='history'
    langData={langData}>
    <main>
        <div class='ag-format-container'>
            <div class='js-timeline ag-timeline'>
                <div class='js-timeline_line ag-timeline_line'>
                    <div class='js-timeline_line-progress ag-timeline_line-progress'></div>
                </div>
                <div class='ag-timeline_list'>
                    {
                        orderedHistory.map((entry, index) => {
                            const media = entry.data.media;
                            const isOdd = index % 2 === 1;
                            const HistoryBody = historyBodies[index];
                            const href = detailHref(lang, 'history', entry.id);

                            return (
                                <div class='lvl js-timeline_item ag-timeline_item'>
                                    <div class='ag-timeline-card_box'>
                                        {isOdd ? (
                                            <>
                                                <div class='ag-timeline-card_meta-box'>
                                                    <div class='ag-timeline-card_meta' set:html={entry.data.meta} />
                                                </div>
                                                <div class='js-timeline-card_point-box ag-timeline-card_point-box'>
                                                    <div class='ag-timeline-card_point'>{media?.year ?? ''}</div>
                                                </div>
                                            </>
                                        ) : (
                                            <>
                                                <div class='js-timeline-card_point-box ag-timeline-card_point-box'>
                                                    <div class='ag-timeline-card_point'>{media?.year ?? ''}</div>
                                                </div>
                                                <div class='ag-timeline-card_meta-box'>
                                                    <div class='ag-timeline-card_meta' set:html={entry.data.meta} />
                                                </div>
                                            </>
                                        )}
                                    </div>
                                    <div class='ag-timeline-card_item'>
                                        <div class='ag-timeline-card_inner'>
                                            <div class='ag-timeline-card_img-box'>
                                                {media ? (
                                                    <img src={media.img} alt={media.alt} class='ag-timeline-card_img' />
                                                ) : null}
                                            </div>
                                            <div class='ag-timeline-card_info'>
                                                <div class='ag-timeline-card_title' set:html={entry.data.title} />
                                                <div class='ag-timeline-card_desc'>
                                                    <TextualContent content={HistoryBody} />
                                                </div>
                                            </div>
                                        </div>
                                        <a class='ag-timeline-card_link' href={href} aria-label={entry.data.meta} />
                                        <div class='ag-timeline-card_arrow' />
                                    </div>
                                </div>
                            );
                        })
                    }
                </div>
            </div>
        </div>
    </main>
    <script src='../../scripts/history.ts'></script>
</BaseLayout>
