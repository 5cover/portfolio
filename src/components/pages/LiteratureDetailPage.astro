---
import BaseLayout from '../../layouts/BaseLayout.astro';
import TextualContent from '../TextualContent.astro';
import Gallery from '../Gallery.astro';
import Graphic from '../Graphic';
import LinkList from '../LinkList';
import ReferenceList from '../ReferenceList.astro';
import { at, getAnchors, getLiterature, getTextualEntry, mapById } from '../../lib/content';
import { getLabels, normalizeLocale } from '../../i18n/site';

interface Props {
    id: string;
    mainClass?: string;
}
const { id, mainClass } = Astro.props;

const locale = normalizeLocale(Astro.currentLocale);
const copy = getLabels(locale).copy;

const literatures = await getLiterature(locale);
const data = at(literatures, id);
if (!data) {
    throw new Error(`Missing literature ${id} for ${locale}`);
}

const body = await getTextualEntry(locale, 'literature', id);
const { Content: Body } = await body.render();

const backgroundStyle = data.background ? `--bg-img: url(${data.background})` : undefined;
const logoTitle = copy.fmtTitle.replace('%s', data.title);
---

<BaseLayout pageName={`literature/${id}`}>
    <main style={backgroundStyle} class={mainClass}>
        <header>
            <h1 set:html={data.title} />
            {data.logo ? <Graphic of={data.logo} alt={logoTitle} title={logoTitle} class='logo' /> : null}
            <p class='abstract' set:html={data.abstract} />
        </header>
        {
            data.links.length > 0 ? (
                <section id='links'>
                    <h2>{copy.links}</h2>
                    <LinkList links={data.links} variant='page' />
                </section>
            ) : null
        }
        <section id='story'>
            <h2>{copy.story}</h2>
            <TextualContent content={Body} />
        </section>
        {
            data.references.length > 0 ? (
                <section id='references'>
                    <h2>{copy.references}</h2>
                    <ReferenceList references={data.references} backlinkLabel={copy.refJumpUp} />
                </section>
            ) : null
        }
        {
            data.gallery.length > 0 ? (
                <section id='gallery'>
                    <h2>{copy.gallery}</h2>
                    <Gallery items={data.gallery} />
                </section>
            ) : null
        }
    </main>
</BaseLayout>
