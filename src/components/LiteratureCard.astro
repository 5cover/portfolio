---
import Graphic from './Graphic.astro';
import LinkList from './LinkList.astro';
import { detailHref } from '../lib/routes';
import type { AnchorEntry, LocalizedLiteratureEntry } from '../lib/content';

function formatTitle(fmt: string, title: string): string {
  return fmt.replace('%s', title);
}

type Props = {
  lang: string;
  route: string;
  langLabels: {
    fmtTitle: string;
  };
  entryId: string;
  entry: LocalizedLiteratureEntry['data'];
  anchorsById: Record<string, AnchorEntry['data']>;
  headingLevel?: number;
};

const props: Props = Astro.props;
const { lang, route, langLabels, entryId, entry, anchorsById, headingLevel = 3 } = props;
const logoTitle = formatTitle(langLabels.fmtTitle, entry.title);
const backgroundStyle = entry.background
  ? `--bg-img-card: url(${entry.background})`
  : undefined;
---
<li id={entryId} style={backgroundStyle}>
  {entry.logo ? (
    <Graphic
      url={entry.logo.url}
      isThemedSvg={entry.logo.isThemedSvg}
      alt={logoTitle}
      title={logoTitle}
      class="logo"
    />
  ) : null}
  <div>
    {headingLevel === 1 ? (
      <h1><a class="foil" href={detailHref(lang, route, entryId)} set:html={entry.title}></a></h1>
    ) : headingLevel === 2 ? (
      <h2><a class="foil" href={detailHref(lang, route, entryId)} set:html={entry.title}></a></h2>
    ) : (
      <h3><a class="foil" href={detailHref(lang, route, entryId)} set:html={entry.title}></a></h3>
    )}
    <p class="abstract" set:html={entry.abstract}></p>
    {entry.links.length > 0 ? (
      <LinkList links={entry.links} anchorsById={anchorsById} />
    ) : null}
  </div>
</li>
