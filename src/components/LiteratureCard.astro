---
import Graphic from './Graphic';
import LinkList from './LinkList';
import { detailHref } from '../lib/links';
import { normalizeLocale } from '../i18n/site';
import type { LiteratureKind, LocalizedItem } from '../content/config';
import type { Entry } from '../lib/content';

function formatTitle(fmt: string, title: string): string {
    return fmt.replace('%s', title);
}

interface Props {
    langLabels: {
        fmtTitle: string;
    };
    entry: Entry<LocalizedItem<'literature'>>;
    headingLevel?: number;
}

const { langLabels, entry, headingLevel = 3 } = Astro.props;
const [id, lit] = entry;
const locale = normalizeLocale(Astro.currentLocale);
const logoTitle = formatTitle(langLabels.fmtTitle, lit.title);
const backgroundStyle = lit.background ? `--bg-img-card: url(${lit.background})` : undefined;
---

<li id={id} style={backgroundStyle}>
    {lit.logo ? <Graphic of={lit.logo} alt={logoTitle} title={logoTitle} class='logo' /> : null}
    <div>
        {
            headingLevel === 1 ? (
                <h1>
                    <a class='foil' href={detailHref(locale, 'literature', id)} set:html={lit.title} />
                </h1>
            ) : headingLevel === 2 ? (
                <h2>
                    <a class='foil' href={detailHref(locale, 'literature', id)} set:html={lit.title} />
                </h2>
            ) : (
                <h3>
                    <a class='foil' href={detailHref(locale, 'literature', id)} set:html={lit.title} />
                </h3>
            )
        }
        <p class='abstract' set:html={lit.abstract} />
        {lit.links.length > 0 ? <LinkList links={lit.links} /> : null}
    </div>
</li>
