---
import LiteratureIndexPage from '../../components/pages/LiteratureIndexPage.astro';
import { getLiterature } from '../../lib/content';
import { getLabels, normalizeLocale } from '../../i18n/site';

const sections = ['blog', 'hobbies'] as const;

type Section = (typeof sections)[number];

export async function getStaticPaths() {
    return (['blog', 'hobbies'] satisfies typeof sections).map(section => ({ params: { section } }));
}

const { section } = Astro.params;
if (!section) {
    throw new Error('Missing route params');
}

const activeSection = sections.find(value => value === section);
if (!activeSection) {
    throw new Error(`Unknown section ${section}`);
}

const locale = normalizeLocale(Astro.currentLocale);
const labels = getLabels(locale);
const literature = await getLiterature(locale);

const isBlog = activeSection === 'blog';
const kind = isBlog ? 'blog' : 'passion';
const title = isBlog ? labels.nav.blog : labels.nav.hobbies;
const entries = literature.filter(entry => entry.data.kind === kind);
---

<LiteratureIndexPage
    title={title}
    route={activeSection}
    langLabels={{ fmtTitle: labels.labels.fmtTitle }}
    entries={entries}
    mainClass='margined'
/>
