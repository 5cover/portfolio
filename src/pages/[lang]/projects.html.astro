---
import ProjectsIndexPage from '../../components/pages/ProjectsIndexPage.astro';
import { getLangData, getLangs } from '../../lib/content';
import { buildLanguages, buildNavItems, buildThemeLabels } from '../../lib/ui';


export async function getStaticPaths() {
    const langs = await getLangs();
    return langs.map(lang => ({ params: { lang } }));
}

const { lang } = Astro.params;
if (!lang) {
    throw new Error('Missing lang param');
}

const [langData, langs] = await Promise.all([getLangData(lang), getLangs()]);
const navItems = buildNavItems(langData);
const themeLabels = buildThemeLabels(langData);
const langMap = Object.fromEntries(await Promise.all(langs.map(async code => [code, await getLangData(code)])));
const languages = buildLanguages(langs, langMap);
---

<ProjectsIndexPage
    lang={lang}
    navItems={navItems}
    languages={languages}
    themeLabels={themeLabels}
    siteDescription={langData.siteDescription}
    githubTitle={langData.footerGitHubAnchorTitle}
    copy={{
        projectSearchSearch: langData.projectSearchSearch,
        projectSearchPlaceholder: langData.projectSearchPlaceholder,
        projectSearchTags: langData.projectSearchTags,
        projectSearchSort: langData.projectSearchSort,
    }}
/>
