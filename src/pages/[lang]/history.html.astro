---
import HistoryIndexPage from '../../components/pages/HistoryIndexPage.astro';
import { getHistory, getLangData, getLangs, getTextualEntry } from '../../lib/content';

export async function getStaticPaths() {
    const langs = await getLangs();
    return langs.map(lang => ({ params: { lang } }));
}

const { lang } = Astro.params;
if (!lang) {
    throw new Error('Missing lang param');
}

const [langData, historyItems] = await Promise.all([getLangData(lang), getHistory(lang)]);

const orderedHistory = [...historyItems].reverse();

const historyBodies = await Promise.all(
    orderedHistory.map(async entry => {
        const bodyEntry = await getTextualEntry(lang, 'history', entry.id);
        const { Content } = await bodyEntry.render();
        return Content;
    })
);

---

<HistoryIndexPage
    lang={lang}
    langData={langData}
    orderedHistory={orderedHistory}
    historyBodies={historyBodies}
/>
