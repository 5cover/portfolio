---
import LiteratureIndexPage from '../../components/pages/LiteratureIndexPage.astro';
import { getLangData, getLangs, getLiterature } from '../../lib/content';

const sections = ['blog', 'hobbies'] as const;

type Section = (typeof sections)[number];
	export async function getStaticPaths() {
  const langs = await getLangs();
  return langs.flatMap((lang) => sections.map((section) => ({ params: { lang, section } })));
}

const { lang, section } = Astro.params;
if (!lang || !section) {
  throw new Error('Missing route params');
}

const activeSection = sections.find((value) => value === section);
if (!activeSection) {
  throw new Error(`Unknown section ${section}`);
}

const [langData, literature] = await Promise.all([
  getLangData(lang),
  getLiterature(lang),
]);

const isBlog = activeSection === 'blog';
const kind = isBlog ? 'blog' : 'passion';
const title = isBlog ? langData.namePagePerspectives : langData.namePagePassions;
const entries = literature.filter((entry) => entry.data.kind === kind);
---

<LiteratureIndexPage
  lang={lang}
  langData={langData}
  title={title}
  route={activeSection}
  langLabels={{ fmtTitle: langData.fmtTitle }}
  entries={entries}
  mainClass="margined"
/>
