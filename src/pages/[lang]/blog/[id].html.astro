---
import LiteratureDetailPage from '../../../components/pages/LiteratureDetailPage.astro';
import { getLangData, getLangs, getLiterature, getTextualEntry } from '../../../lib/content';

import '../../../styles/perspective.scss';

export async function getStaticPaths() {
  const langs = await getLangs();
  const paths = await Promise.all(
    langs.map(async (lang) => {
      const entries = await getLiterature(lang);
      return entries
        .filter((entry) => entry.data.kind === 'blog')
        .map((entry) => ({ params: { lang, id: entry.id } }));
    })
  );

  return paths.flat();
}

const { lang, id } = Astro.params;
if (!lang || !id) {
  throw new Error('Missing route params');
}

const [langData, literature] = await Promise.all([getLangData(lang), getLiterature(lang)]);

const entry = literature.find((item) => item.id === id && item.data.kind === 'blog');
if (!entry) {
  throw new Error(`Missing blog ${id} for ${lang}`);
}

const blogBodyEntry = await getTextualEntry(lang, 'literature', entry.id);
const { Content: BlogBody } = await blogBodyEntry.render();

---
<LiteratureDetailPage
  lang={lang}
  langData={langData}
  route="blog"
  entry={entry}
  Body={BlogBody}
  copy={{
    links: langData.links,
    story: langData.story,
    references: langData.references,
    gallery: langData.gallery,
    fmtTitle: langData.fmtTitle,
    refJumpUp: langData.refJumpUp,
  }}
/>
